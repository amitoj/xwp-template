<html>
  <head>
    <style>
      div.form     { margin-bottom: 12px; width: 360px; }
      div.progress { border: solid 1px; width: 360px; height: 14px; }
      div.bar      { background-color: #3cf; height: 14px; } 
      div.label    { margin-top: 6px; float: right; }
    </style>
    <script>

      function upload() {
        var file = document.getElementById('file').files[0];
        var formData = new FormData();
        formData.append('file', file, file.name);

        var xhr = new XMLHttpRequest();
        xhr.open("post", "/upload", true);
        xhr.onreadystatechange =
          function() {
            if (xhr.readyState == 3 && xhr.status == 200) {
              var chunks = xhr.responseText.split('\n');
              var chunk = chunks[chunks.length - 2];
              document.getElementById('bar').style.width = chunk;
              document.getElementById('label').innerHTML = chunk;
            }
            if (xhr.readyState == 4 && xhr.status == 200) {
              document.getElementById('label').innerHTML = "Done!";
            }
          };
        xhr.send(formData);
      }

    </script>
  </head>
  <body>

    <div class="form">
      <input type="file" id="file" name="file" />
      <button style="float: right;" onclick="upload()">upload</button>
    </div>

    <div class="progress">
      <div id="bar" class="bar" style="width: 0%">
        &nbsp;
      </div>
      <div id="label" class="label">
        &nbsp;
      </div>
    </div>

  </body>
</head>
