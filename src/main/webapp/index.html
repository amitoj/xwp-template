<html>
  <head>
    <script>

      function XHR() {
        if (window.XMLHttpRequest) {
          // IE7+, Firefox, Chrome, Opera, Safari
          return new XMLHttpRequest();
        } else {
          // IE6, IE5
          return new ActiveXObject('Microsoft.XMLHTTP');
        }
      }

      function println(html) {
        var div = document.createElement('div');
        div.innerHTML = html;
        document.getElementsByTagName('body')[0].appendChild(div);
      }

      function chunkDemo(xhr) {
        var len = 0;
        xhr.onreadystatechange =
          function() {
            if (xhr.readyState == 3 && xhr.status == 200) {
              var chunk = xhr.responseText.substr(len);
              len = len + chunk.length; 
              println(chunk);
            }
            if (xhr.readyState == 4 && xhr.status == 200) {
              println('<hr />');
            }
          }
        xhr.open('POST', '/echo', true);
        xhr.send('hello\nworld\n\n1\n2\n3\n4\n5');
      }

      function go() {
        chunkDemo(XHR());
      }

    </script>
  </head>
  <body>
    <button onclick="go()">go</button>
    <hr />
  </body>
</head>
